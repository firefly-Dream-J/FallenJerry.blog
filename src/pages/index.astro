---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { Icon } from 'astro-icon/components';

const allPosts = await getCollection('blog');
const recentPosts = allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()).slice(0, 5);

// --- üè∑Ô∏è Êñ∞Â¢ûÈÄªËæëÔºöÊèêÂèñÂπ∂ÁªüËÆ°Ê†áÁ≠æ ---
const tags = [...new Set(allPosts.map((post) => post.data.tags || []).flat())];

// ÁªüËÆ°Êï∞ÊçÆ
const postCount = allPosts.length;
const tagCount = tags.length;
const categoryCount = 0; 
---

<BaseLayout title="È¶ñÈ°µ">
  
  <div id="hero" class="hero-section">
    <div class="hero-content fade-in-up">
      <h1>Jerry's Blog</h1>
      <p>‚ÄúÊàëÊ¢¶ËßÅ‰∏ÄÁâáÁÑ¶ÂúüÔºå‰∏ÄÊ†™Á†¥ÂúüËÄåÂá∫ÁöÑÊñ∞ËïäÔºåÂêëÁùÄÊúùÈò≥ÁªΩÊîæ‚Äù</p>
    </div>

    <div class="scroll-arrow bounce" id="scroll-btn">
      <Icon name="lucide:chevron-down" size={40} />
    </div>
  </div>

  <div id="content" class="content-section">
    <div class="grid-container">

      <div class="main-column fade-in-up delay-1">
        <div class="glass-card">
          <div class="card-header">
            <h2><Icon name="lucide:sparkles" class="icon-inline"/> ÊúÄÊñ∞ËßÇÊµãËÆ∞ÂΩï</h2>
          </div>
          
          <ul class="post-list">
            {recentPosts.map((post) => (
              <li class="post-item">
                <a href={`/blog/${post.slug}/`}>
                  <div class="post-info">
                    <span class="post-title">{post.data.title}</span>
                  </div>
                  <span class="post-date">{post.data.pubDate.toISOString().slice(0, 10)}</span>
                </a>
              </li>
            ))}
          </ul>

          <div class="more-link">
            <a href="/archive" class="btn-outline">Êü•ÁúãÊõ¥Â§ö &rarr;</a>
          </div>
        </div>
      </div>

      <div class="sidebar-column fade-in-up delay-2">
        <div class="glass-card profile-card">
          <div class="profile-banner"></div>
          
          <div class="profile-content">
            <img src="/avatar.jpg" alt="Avatar" class="profile-avatar" />
            <h3 class="profile-name">Jerry</h3>
            <p class="profile-bio">ÁÉ≠Áà±ÁîüÊ¥ªÔºåÂñúÊ¨¢Èü≥‰πê</p>
            
            <div class="profile-stats">
              <div class="stat-item"><span class="stat-num">{postCount}</span><span class="stat-label">ÊñáÁ´†</span></div>
              <div class="stat-item"><span class="stat-num">{tagCount}</span><span class="stat-label">Ê†áÁ≠æ</span></div>
              <div class="stat-item"><span class="stat-num">{categoryCount}</span><span class="stat-label">ÂàÜÁ±ª</span></div>
            </div>
            
            <a href="https://github.com/firefly-Dream-J" target="_blank" class="follow-btn">
               <Icon name="lucide:github" /> Follow Me
            </a>
            
            <div class="tags-section">
              <div class="tags-header">
                <Icon name="lucide:tags" /> Ê†áÁ≠æ‰∫ë
              </div>
              <div class="tags-cloud">
                {tags.length === 0 && <span class="no-tags">ÊöÇÊó†Ê†áÁ≠æ</span>}
                {tags.map((tag) => (
                  <a href={`/tags/${tag}`} class="tag-chip">
                    # {tag}
                  </a>
                ))}
              </div>
            </div>

            <div class="social-links">
              <a href="https://github.com/firefly-Dream-J" target="_blank" class="social-btn" aria-label="GitHub">
                <Icon name="lucide:github" />
              </a>
              <a href="/qq-qr.jpg" target="_blank" class="social-btn" aria-label="QQ">
                <Icon name="lucide:message-circle" /> 
              </a>
              <a href="/wechat-qr.jpg" target="_blank" class="social-btn" aria-label="WeChat">
                <Icon name="lucide:smartphone" /> 
              </a>
              <div class="social-btn-wrapper">
                <a href="mailto:your_email@example.com" class="social-btn">
                  <Icon name="lucide:mail" />
                </a>
                <div class="tooltip-popup text-box">
                  <div>2648783968@qq.com</div>
                  <div style="margin-top:4px; opacity:0.8; font-size:0.9em;">your_second_email@gmail.com</div>
                </div>
              </div>
            </div>

          </div>
        </div>

        <div class="glass-card notice-card mt-4">
            <h4><Icon name="lucide:megaphone" class="icon-inline"/> ÂÖ¨Âëä</h4>
            <p>ÂçöÂÆ¢ÊñΩÂ∑•‰∏≠...<br/><span style="font-size:0.8em;opacity:0.7;">System Status: Normal</span></p>
        </div>
      </div>

    </div>
  </div>

</BaseLayout>

<style is:global>
  main {
    width: 100% !important;
    max-width: 100% !important;
    padding: 0 !important;
    margin: 0 !important;
  }
</style>

<style>
  /* --- Hero ÂÖ®Â±èÂå∫Âüü --- */
  .hero-section {
    height: 100vh;
    width: 100%;
    position: relative;
    top:0; left:0;
    background-image: url('/splash.jpg'); 
    background-size: cover;
    background-position: center;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    box-shadow: inset 0 -150px 150px -50px #0F172A;
  }
  .hero-content { text-align: center; z-index: 2; }
  .hero-content h1 { font-size: 3.5rem; margin-bottom: 0.5rem; letter-spacing: 2px; color: #fff; text-shadow: 0 4px 10px rgba(0,0,0,0.5); }
  .hero-content p { font-size: 1.2rem; opacity: 0.9; font-weight: 300; color: #eee; }

  .scroll-arrow { position: absolute; bottom: 30px; cursor: pointer; color: var(--accent); transition: 0.3s; z-index: 5; }
  .scroll-arrow:hover { color: white; transform: scale(1.1); }

  /* --- Â∏ÉÂ±ÄÊ†∏ÂøÉÊ†∑Âºè --- */
  .content-section {
    padding: 40px 20px;
    max-width: 1400px;
    margin: 0 auto;
  }

  .grid-container {
    display: grid;
    grid-template-columns: 1fr 320px; 
    gap: 40px;
    align-items: start;
  }

  /* --- Ê∑±Ëâ≤ÊØõÁéªÁíÉÂç°Áâá --- */
  .glass-card {
    background: rgba(15, 23, 42, 0.6); 
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    padding: 30px;
    overflow: hidden;
    transition: transform 0.3s ease;
  }
  .glass-card:hover {
    border-color: rgba(255, 255, 255, 0.2);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
  }

  .main-column { width: 100%; }
  .main-column .glass-card { width: 100%; max-width: 850px; margin: 0 auto; }

  .card-header h2 {
    font-size: 1.6rem; color: #fff;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    padding-bottom: 15px; margin-bottom: 20px;
    display: flex; align-items: center; gap: 10px;
  }
  .icon-inline { color: var(--accent); }

  .post-list { list-style: none; padding: 0; margin: 0; }
  .post-item { padding: 15px 0; border-bottom: 1px dashed rgba(255,255,255,0.1); transition: 0.2s; }
  .post-item:last-child { border-bottom: none; }
  
  .post-item a { display: flex; justify-content: space-between; align-items: center; text-decoration: none; }
  .post-title { font-size: 1.1rem; color: #e2e8f0; transition: 0.2s; font-weight: 500; }
  .post-date { font-size: 0.9rem; color: #94a3b8; font-family: monospace; }
  .post-item a:hover .post-title { color: var(--accent); padding-left: 8px; }
  
  .more-link { text-align: center; margin-top: 30px; }
  .btn-outline { padding: 10px 30px; border: 1px solid var(--accent); border-radius: 50px; color: var(--accent); transition: 0.3s; text-decoration: none; }
  .btn-outline:hover { background: var(--accent); color: #0F172A; font-weight: bold; }

  /* --- Âè≥‰æß‰æßËæπÊ†è --- */
  .sidebar-column { position: sticky; top: 100px; width: 100%; }
  .profile-card { padding: 0 !important; text-align: center; overflow: visible !important; } 
  .profile-banner { height: 100px; width: 100%; background: linear-gradient(135deg, #1e293b, #0f172a); border-radius: 16px 16px 0 0;}
  .profile-content { padding: 0 20px 25px 20px; position: relative; }
  .profile-avatar { width: 80px; height: 80px; border-radius: 50%; border: 4px solid rgba(15, 23, 42, 0.8); margin-top: -40px; background: #000; transition: 0.5s; }
  .profile-avatar:hover { transform: rotate(360deg); }
  
  .profile-name { margin: 10px 0 5px 0; font-size: 1.4rem; color: var(--accent); font-weight: bold; }
  .profile-bio { font-size: 0.85rem; color: #94a3b8; margin-bottom: 15px; background: rgba(255,255,255,0.05); display: inline-block; padding: 4px 12px; border-radius: 20px;}
  
  .profile-stats { display: flex; justify-content: space-around; margin-bottom: 20px; border-top: 1px solid rgba(255,255,255,0.1); border-bottom: 1px solid rgba(255,255,255,0.1); padding: 15px 0; }
  .stat-num { font-weight: bold; font-size: 1.2rem; color: #fff; display: block; }
  .stat-label { font-size: 0.8rem; color: #94a3b8; }

  .follow-btn { display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; padding: 10px; background: var(--accent); color: #0F172A; font-weight: bold; border-radius: 12px; transition: 0.3s; margin-bottom: 20px; text-decoration: none; }
  .follow-btn:hover { background: var(--accent-dark); transform: translateY(-2px); }

  /* --- üè∑Ô∏è Ê†áÁ≠æ‰∫ëÊ†∑Âºè (Êñ∞) --- */
  .tags-section {
    padding: 20px;
    border-top: 1px solid rgba(255,255,255,0.1);
    border-bottom: 1px solid rgba(255,255,255,0.1);
    margin: 15px 0;
    text-align: left;
  }
  .tags-header {
    font-size: 0.9rem; color: #94a3b8; margin-bottom: 15px;
    display: flex; align-items: center; gap: 8px; font-weight: bold;
  }
  .tags-cloud { display: flex; flex-wrap: wrap; gap: 8px; }
  .tag-chip {
    font-size: 0.85rem; color: #e2e8f0; background: rgba(255,255,255,0.05);
    padding: 4px 10px; border-radius: 6px; text-decoration: none;
    transition: 0.3s; border: 1px solid transparent;
  }
  .tag-chip:hover {
    background: rgba(94, 234, 212, 0.1); color: var(--accent);
    border-color: rgba(94, 234, 212, 0.3); transform: translateY(-2px);
  }
  .no-tags { font-size: 0.8rem; color: #64748b; font-style: italic; }

  /* --- Á§æ‰∫§ÂõæÊ†áÊ†∑Âºè --- */
  .social-links { display: flex; justify-content: center; gap: 10px; align-items: center; flex-wrap: wrap; margin-top: 15px; }
  .social-btn-wrapper { position: relative; display: flex; align-items: center; justify-content: center; }
  .social-btn { color: #94a3b8; font-size: 1.1rem; transition: 0.3s; padding: 8px; width: 38px; height: 38px; background: rgba(255,255,255,0.05); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; text-decoration: none; }
  .social-btn:hover { color: var(--accent); background: rgba(255,255,255,0.1); transform: translateY(-3px); }

  .tooltip-popup {
    position: absolute; bottom: 125%; left: 50%; transform: translateX(-50%) translateY(10px);
    background: #fff; padding: 8px; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.5);
    opacity: 0; visibility: hidden; transition: all 0.3s; pointer-events: none; z-index: 100;
  }
  .tooltip-popup::after {
    content: ''; position: absolute; top: 100%; left: 50%; margin-left: -6px;
    border-width: 6px; border-style: solid; border-color: #fff transparent transparent transparent;
  }
  .social-btn-wrapper:hover .tooltip-popup { opacity: 1; visibility: visible; transform: translateX(-50%) translateY(0); }
  .text-box { white-space: nowrap; font-size: 0.85rem; color: #333; font-weight: bold; padding: 8px 12px; text-align: center; }

  .notice-card h4 { color: var(--accent-secondary); margin-bottom: 10px; font-size: 1rem; display: flex; align-items: center; gap: 8px;}
  .notice-card p { font-size: 0.9em; color: #cbd5e1; }
  .mt-4 { margin-top: 20px; }

  .bounce { animation: bounce 2s infinite; }
  @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-10px);} 60% {transform: translateY(-5px);} }
  .fade-in-up { opacity: 0; transform: translateY(20px); animation: fadeInUp 0.8s forwards; }
  .delay-1 { animation-delay: 0.3s; }
  .delay-2 { animation-delay: 0.5s; }
  @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

  @media (max-width: 900px) {
    .grid-container { grid-template-columns: 1fr; }
    .sidebar-column { position: static; order: -1; margin-bottom: 30px; }
    .main-column .glass-card { max-width: 100%; } 
  }
</style>

<script>
  const scrollBtn = document.getElementById('scroll-btn');
  const heroSection = document.getElementById('hero');
  const contentSection = document.getElementById('content');

  if (scrollBtn && contentSection) {
    scrollBtn.addEventListener('click', () => {
      contentSection.scrollIntoView({ behavior: 'smooth' });
    });
  }
  if (heroSection && contentSection) {
    heroSection.addEventListener('click', (e) => {
        if(e.target === heroSection) {
            contentSection.scrollIntoView({ behavior: 'smooth' });
        }
    });
  }
</script>