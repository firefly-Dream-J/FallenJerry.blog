---
import BaseLayout from '../layouts/BaseLayout.astro';
import { Icon } from 'astro-icon/components';

const items = [
  {
    title: '自我介绍',
    en: 'About Me',
    link: '/about/intro',
    color: '#5EEAD4',
    delay: '0s',
    height: '150px'
  },
  {
    title: '兴趣爱好',
    en: 'Hobbies',
    link: '/about/hobbies',
    color: '#FDE68A',
    delay: '0.2s',
    height: '220px'
  },
  {
    title: '最喜欢的',
    en: 'Favorites',
    link: '/about/favorites',
    color: '#F472B6',
    delay: '0.4s',
    height: '180px'
  },
  {
    title: '生活日常',
    en: 'Daily Life',
    link: '/about/daily',
    color: '#A78BFA',
    delay: '0.6s',
    height: '260px'
  }
];
---

<BaseLayout title="关于我">
  <div class="about-container">
    
    <div class="stars-wrapper">
      {items.map((item) => (
        <div class="pendant-wrapper" style={`--delay: ${item.delay}`}>
          
          <div class="pendant-group" style={`--line-height: ${item.height}; --item-color: ${item.color}`}>
            
            <div class="string"></div>
            
            <a href={item.link} class="star-shape" draggable="false">
              <div class="star-content">
                <span class="label-cn">{item.title}</span>
                <span class="label-en">{item.en}</span>
              </div>
              
              <svg class="star-bg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                <path d="M100 0 C 100 0 130 70 200 100 C 130 130 100 200 100 200 C 100 200 70 130 0 100 C 70 70 100 0 100 0 Z" />
              </svg>
            </a>

          </div>
        </div>
      ))}
    </div>

  </div>
</BaseLayout>

<style is:global>
  main {
    width: 100% !important;
    max-width: 100% !important;
    padding: 0 !important;
    margin: 0 !important;
  }
</style>

<style>
  .about-container {
    min-height: 100vh;
    width: 100%;
    display: flex;
    justify-content: center;
    overflow: hidden; 
    position: relative;
    user-select: none;
  }

  .stars-wrapper {
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    gap: 8vw; 
    margin-top: -20px;
    padding: 0 100px; 
    flex-wrap: nowrap; 
    justify-content: center;
    width: 100%;
  }

  .pendant-wrapper {
    margin: 0;
    padding: 0;
    transform: translateY(-100vh);
    animation: dropDown 1.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    animation-delay: var(--delay);
    flex-shrink: 0; 
  }

  .pendant-group {
    display: flex;
    flex-direction: column;
    align-items: center;
    transform-origin: top center;
    transition: transform 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    cursor: grab;
    position: relative; 
    z-index: 1;
  }
  
  .pendant-group:active {
    cursor: grabbing;
    z-index: 10; 
  }

  .string {
    width: 2px;
    height: var(--line-height);
    background: linear-gradient(to bottom, transparent, rgba(255,255,255,0.5), var(--item-color));
    box-shadow: 0 0 10px var(--item-color);
    transition: height 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); 
  }

  .pendant-group:hover .string {
    height: calc(var(--line-height) + 30px);
  }

  .star-shape {
    position: relative;
    width: 140px;
    height: 140px;
    display: flex;
    justify-content: center;
    align-items: center;
    text-decoration: none;
    transition: transform 0.3s ease, filter 0.3s ease;
  }

  .star-bg {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    fill: rgba(15, 23, 42, 0.8);
    stroke: var(--item-color);
    stroke-width: 2px;
    filter: drop-shadow(0 0 10px var(--item-color));
    z-index: 1;
    transition: 0.3s;
  }

  .star-content {
    z-index: 2;
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #fff;
    text-align: center;
    pointer-events: none;
  }

  .label-cn { font-size: 1.1rem; font-weight: bold; text-shadow: 0 2px 4px rgba(0,0,0,0.8); }
  .label-en { font-size: 0.7rem; opacity: 0.8; font-family: monospace; }

  .pendant-group:hover .star-bg {
    fill: rgba(255, 255, 255, 0.15);
    stroke-width: 3px;
  }
  .pendant-group:hover .star-shape {
    filter: brightness(1.2);
    transform: scale(1.05); 
  }

  @keyframes dropDown {
    0% { transform: translateY(-100vh); }
    100% { transform: translateY(0); }
  }

  @media (max-width: 768px) {
    .stars-wrapper { gap: 15px; padding: 0 10px; }
    .star-shape { width: 100px; height: 100px; }
    .label-cn { font-size: 0.9rem; }
    .label-en { display: none; }
    .string { height: calc(var(--line-height) * 0.6); }
    .pendant-group:hover .string { height: calc(var(--line-height) * 0.6 + 20px); }
  }
</style>

<script>
  const groups = document.querySelectorAll('.pendant-group');

  groups.forEach(group => {
    let isDragging = false;
    let startX = 0;
    let startY = 0;
    let hasMoved = false;

    const el = group as HTMLElement;
    const link = el.querySelector('a');
    const stringEl = el.querySelector('.string') as HTMLElement;

    el.addEventListener('mousedown', (e) => {
      isDragging = true;
      hasMoved = false;
      startX = e.clientX;
      startY = e.clientY;
      
      el.style.transition = 'none';
      if (stringEl) stringEl.style.transition = 'none';
      el.style.cursor = 'grabbing';
    });

    window.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      
      const deltaX = e.clientX - startX;
      const deltaY = e.clientY - startY;
      
      if (Math.abs(deltaX) > 3 || Math.abs(deltaY) > 3) {
        hasMoved = true;
      }

      let rotate = deltaX * 0.1; 
      rotate = Math.max(-15, Math.min(15, rotate)); 
      
      let stretch = Math.max(0, deltaY * 0.5); 
      stretch = Math.min(stretch, 150); 
      
      el.style.transform = `rotate(${rotate}deg)`;
      
      if (stringEl) {
        const baseHeightStr = el.style.getPropertyValue('--line-height');
        stringEl.style.height = `calc(${baseHeightStr} + ${stretch}px)`;
      }
    });

    window.addEventListener('mouseup', () => {
      if (!isDragging) return;
      isDragging = false;
      el.style.cursor = 'grab';

      el.style.transition = 'transform 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
      el.style.transform = 'rotate(0deg)';
      
      if (stringEl) {
        stringEl.style.transition = 'height 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
        stringEl.style.height = ''; 
      }
    });

    if (link) {
      link.addEventListener('click', (e) => {
        if (hasMoved) e.preventDefault();
      });
    }
  });
</script>